/**
 * Copyright 2013-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * 
 */

'use strict';

var EventPluginUtils = require('./EventPluginUtils');
var EventPropagators = require('./EventPropagators');
var SyntheticUIEvent = require('./SyntheticUIEvent');
var TouchEventUtils = require('fbjs/lib/TouchEventUtils');
var ViewportMetrics = require('./ViewportMetrics');

var isStartish = EventPluginUtils.isStartish;
var isEndish = EventPluginUtils.isEndish;

/**
 * We are extending the Flow 'Touch' declaration to enable using bracket
 * notation to access properties.
 * Without this adjustment Flow throws
 * "Indexable signature not found in Touch".
 * See https://github.com/facebook/flow/issues/1323
 */

/**
 * Number of pixels that are tolerated in between a `touchStart` and `touchEnd`
 * in order to still be considered a 'tap' event.
 */
var tapMoveThreshold = 10;
var startCoords = { x: 0, y: 0 };

var Axis = {
  x: { page: 'pageX', client: 'clientX', envScroll: 'currentPageScrollLeft' },
  y: { page: 'pageY', client: 'clientY', envScroll: 'currentPageScrollTop' }
};

function getAxisCoordOfEvent(axis, nativeEvent) {
  var singleTouch = TouchEventUtils.extractSingleTouch(nativeEvent);
  if (singleTouch) {
    return singleTouch[axis.page];
  }
  return axis.page in nativeEvent ? nativeEvent[axis.page] : nativeEvent[axis.client] + ViewportMetrics[axis.envScroll];
}

function getDistance(coords, nativeEvent) {
  var pageX = getAxisCoordOfEvent(Axis.x, nativeEvent);
  var pageY = getAxisCoordOfEvent(Axis.y, nativeEvent);
  return Math.pow(Math.pow(pageX - coords.x, 2) + Math.pow(pageY - coords.y, 2), 0.5);
}

var touchEvents = ['topTouchStart', 'topTouchCancel', 'topTouchEnd', 'topTouchMove'];

var dependencies = ['topMouseDown', 'topMouseMove', 'topMouseUp'].concat(touchEvents);

var eventTypes = {
  touchTap: {
    phasedRegistrationNames: {
      bubbled: 'onTouchTap',
      captured: 'onTouchTapCapture'
    },
    dependencies: dependencies
  }
};

var usedTouch = false;
var usedTouchTime = 0;
var TOUCH_DELAY = 1000;

var TapEventPlugin = {

  tapMoveThreshold: tapMoveThreshold,

  eventTypes: eventTypes,

  extractEvents: function extractEvents(topLevelType, targetInst, nativeEvent, nativeEventTarget) {
    if (!isStartish(topLevelType) && !isEndish(topLevelType)) {
      return null;
    }
    // on ios, there is a delay after touch event and synthetic
    // mouse events, so that user can perform double tap
    // solution: ignore mouse events following touchevent within small timeframe
    if (touchEvents.indexOf(topLevelType) !== -1) {
      usedTouch = true;
      usedTouchTime = Date.now();
    } else {
      if (usedTouch && Date.now() - usedTouchTime < TOUCH_DELAY) {
        return null;
      }
    }
    var event = null;
    var distance = getDistance(startCoords, nativeEvent);
    if (isEndish(topLevelType) && distance < tapMoveThreshold) {
      event = SyntheticUIEvent.getPooled(eventTypes.touchTap, targetInst, nativeEvent, nativeEventTarget);
    }
    if (isStartish(topLevelType)) {
      startCoords.x = getAxisCoordOfEvent(Axis.x, nativeEvent);
      startCoords.y = getAxisCoordOfEvent(Axis.y, nativeEvent);
    } else if (isEndish(topLevelType)) {
      startCoords.x = 0;
      startCoords.y = 0;
    }
    EventPropagators.accumulateTwoPhaseDispatches(event);
    return event;
  }

};

module.exports = TapEventPlugin;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3B1YmxpYy9saWIvcmVhY3QtZG9tL2xpYi9UYXBFdmVudFBsdWdpbi5qcyJdLCJuYW1lcyI6WyJFdmVudFBsdWdpblV0aWxzIiwicmVxdWlyZSIsIkV2ZW50UHJvcGFnYXRvcnMiLCJTeW50aGV0aWNVSUV2ZW50IiwiVG91Y2hFdmVudFV0aWxzIiwiVmlld3BvcnRNZXRyaWNzIiwiaXNTdGFydGlzaCIsImlzRW5kaXNoIiwidGFwTW92ZVRocmVzaG9sZCIsInN0YXJ0Q29vcmRzIiwieCIsInkiLCJBeGlzIiwicGFnZSIsImNsaWVudCIsImVudlNjcm9sbCIsImdldEF4aXNDb29yZE9mRXZlbnQiLCJheGlzIiwibmF0aXZlRXZlbnQiLCJzaW5nbGVUb3VjaCIsImV4dHJhY3RTaW5nbGVUb3VjaCIsImdldERpc3RhbmNlIiwiY29vcmRzIiwicGFnZVgiLCJwYWdlWSIsIk1hdGgiLCJwb3ciLCJ0b3VjaEV2ZW50cyIsImRlcGVuZGVuY2llcyIsImNvbmNhdCIsImV2ZW50VHlwZXMiLCJ0b3VjaFRhcCIsInBoYXNlZFJlZ2lzdHJhdGlvbk5hbWVzIiwiYnViYmxlZCIsImNhcHR1cmVkIiwidXNlZFRvdWNoIiwidXNlZFRvdWNoVGltZSIsIlRPVUNIX0RFTEFZIiwiVGFwRXZlbnRQbHVnaW4iLCJleHRyYWN0RXZlbnRzIiwidG9wTGV2ZWxUeXBlIiwidGFyZ2V0SW5zdCIsIm5hdGl2ZUV2ZW50VGFyZ2V0IiwiaW5kZXhPZiIsIkRhdGUiLCJub3ciLCJldmVudCIsImRpc3RhbmNlIiwiZ2V0UG9vbGVkIiwiYWNjdW11bGF0ZVR3b1BoYXNlRGlzcGF0Y2hlcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztBQVdBOztBQUVBLElBQUlBLG1CQUFtQkMsUUFBUSxvQkFBUixDQUF2QjtBQUNBLElBQUlDLG1CQUFtQkQsUUFBUSxvQkFBUixDQUF2QjtBQUNBLElBQUlFLG1CQUFtQkYsUUFBUSxvQkFBUixDQUF2QjtBQUNBLElBQUlHLGtCQUFrQkgsUUFBUSwwQkFBUixDQUF0QjtBQUNBLElBQUlJLGtCQUFrQkosUUFBUSxtQkFBUixDQUF0Qjs7QUFFQSxJQUFJSyxhQUFhTixpQkFBaUJNLFVBQWxDO0FBQ0EsSUFBSUMsV0FBV1AsaUJBQWlCTyxRQUFoQzs7QUFFQTs7Ozs7Ozs7QUFTQTs7OztBQUlBLElBQUlDLG1CQUFtQixFQUF2QjtBQUNBLElBQUlDLGNBQWMsRUFBRUMsR0FBRyxDQUFMLEVBQVFDLEdBQUcsQ0FBWCxFQUFsQjs7QUFFQSxJQUFJQyxPQUFPO0FBQ1RGLEtBQUcsRUFBRUcsTUFBTSxPQUFSLEVBQWlCQyxRQUFRLFNBQXpCLEVBQW9DQyxXQUFXLHVCQUEvQyxFQURNO0FBRVRKLEtBQUcsRUFBRUUsTUFBTSxPQUFSLEVBQWlCQyxRQUFRLFNBQXpCLEVBQW9DQyxXQUFXLHNCQUEvQztBQUZNLENBQVg7O0FBS0EsU0FBU0MsbUJBQVQsQ0FBNkJDLElBQTdCLEVBQW1DQyxXQUFuQyxFQUFnRDtBQUM5QyxNQUFJQyxjQUFjZixnQkFBZ0JnQixrQkFBaEIsQ0FBbUNGLFdBQW5DLENBQWxCO0FBQ0EsTUFBSUMsV0FBSixFQUFpQjtBQUNmLFdBQU9BLFlBQVlGLEtBQUtKLElBQWpCLENBQVA7QUFDRDtBQUNELFNBQU9JLEtBQUtKLElBQUwsSUFBYUssV0FBYixHQUEyQkEsWUFBWUQsS0FBS0osSUFBakIsQ0FBM0IsR0FBb0RLLFlBQVlELEtBQUtILE1BQWpCLElBQTJCVCxnQkFBZ0JZLEtBQUtGLFNBQXJCLENBQXRGO0FBQ0Q7O0FBRUQsU0FBU00sV0FBVCxDQUFxQkMsTUFBckIsRUFBNkJKLFdBQTdCLEVBQTBDO0FBQ3hDLE1BQUlLLFFBQVFQLG9CQUFvQkosS0FBS0YsQ0FBekIsRUFBNEJRLFdBQTVCLENBQVo7QUFDQSxNQUFJTSxRQUFRUixvQkFBb0JKLEtBQUtELENBQXpCLEVBQTRCTyxXQUE1QixDQUFaO0FBQ0EsU0FBT08sS0FBS0MsR0FBTCxDQUFTRCxLQUFLQyxHQUFMLENBQVNILFFBQVFELE9BQU9aLENBQXhCLEVBQTJCLENBQTNCLElBQWdDZSxLQUFLQyxHQUFMLENBQVNGLFFBQVFGLE9BQU9YLENBQXhCLEVBQTJCLENBQTNCLENBQXpDLEVBQXdFLEdBQXhFLENBQVA7QUFDRDs7QUFFRCxJQUFJZ0IsY0FBYyxDQUFDLGVBQUQsRUFBa0IsZ0JBQWxCLEVBQW9DLGFBQXBDLEVBQW1ELGNBQW5ELENBQWxCOztBQUVBLElBQUlDLGVBQWUsQ0FBQyxjQUFELEVBQWlCLGNBQWpCLEVBQWlDLFlBQWpDLEVBQStDQyxNQUEvQyxDQUFzREYsV0FBdEQsQ0FBbkI7O0FBRUEsSUFBSUcsYUFBYTtBQUNmQyxZQUFVO0FBQ1JDLDZCQUF5QjtBQUN2QkMsZUFBUyxZQURjO0FBRXZCQyxnQkFBVTtBQUZhLEtBRGpCO0FBS1JOLGtCQUFjQTtBQUxOO0FBREssQ0FBakI7O0FBVUEsSUFBSU8sWUFBWSxLQUFoQjtBQUNBLElBQUlDLGdCQUFnQixDQUFwQjtBQUNBLElBQUlDLGNBQWMsSUFBbEI7O0FBRUEsSUFBSUMsaUJBQWlCOztBQUVuQjlCLG9CQUFrQkEsZ0JBRkM7O0FBSW5Cc0IsY0FBWUEsVUFKTzs7QUFNbkJTLGlCQUFlLHVCQUFVQyxZQUFWLEVBQXdCQyxVQUF4QixFQUFvQ3ZCLFdBQXBDLEVBQWlEd0IsaUJBQWpELEVBQW9FO0FBQ2pGLFFBQUksQ0FBQ3BDLFdBQVdrQyxZQUFYLENBQUQsSUFBNkIsQ0FBQ2pDLFNBQVNpQyxZQUFULENBQWxDLEVBQTBEO0FBQ3hELGFBQU8sSUFBUDtBQUNEO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBSWIsWUFBWWdCLE9BQVosQ0FBb0JILFlBQXBCLE1BQXNDLENBQUMsQ0FBM0MsRUFBOEM7QUFDNUNMLGtCQUFZLElBQVo7QUFDQUMsc0JBQWdCUSxLQUFLQyxHQUFMLEVBQWhCO0FBQ0QsS0FIRCxNQUdPO0FBQ0wsVUFBSVYsYUFBYVMsS0FBS0MsR0FBTCxLQUFhVCxhQUFiLEdBQTZCQyxXQUE5QyxFQUEyRDtBQUN6RCxlQUFPLElBQVA7QUFDRDtBQUNGO0FBQ0QsUUFBSVMsUUFBUSxJQUFaO0FBQ0EsUUFBSUMsV0FBVzFCLFlBQVlaLFdBQVosRUFBeUJTLFdBQXpCLENBQWY7QUFDQSxRQUFJWCxTQUFTaUMsWUFBVCxLQUEwQk8sV0FBV3ZDLGdCQUF6QyxFQUEyRDtBQUN6RHNDLGNBQVEzQyxpQkFBaUI2QyxTQUFqQixDQUEyQmxCLFdBQVdDLFFBQXRDLEVBQWdEVSxVQUFoRCxFQUE0RHZCLFdBQTVELEVBQXlFd0IsaUJBQXpFLENBQVI7QUFDRDtBQUNELFFBQUlwQyxXQUFXa0MsWUFBWCxDQUFKLEVBQThCO0FBQzVCL0Isa0JBQVlDLENBQVosR0FBZ0JNLG9CQUFvQkosS0FBS0YsQ0FBekIsRUFBNEJRLFdBQTVCLENBQWhCO0FBQ0FULGtCQUFZRSxDQUFaLEdBQWdCSyxvQkFBb0JKLEtBQUtELENBQXpCLEVBQTRCTyxXQUE1QixDQUFoQjtBQUNELEtBSEQsTUFHTyxJQUFJWCxTQUFTaUMsWUFBVCxDQUFKLEVBQTRCO0FBQ2pDL0Isa0JBQVlDLENBQVosR0FBZ0IsQ0FBaEI7QUFDQUQsa0JBQVlFLENBQVosR0FBZ0IsQ0FBaEI7QUFDRDtBQUNEVCxxQkFBaUIrQyw0QkFBakIsQ0FBOENILEtBQTlDO0FBQ0EsV0FBT0EsS0FBUDtBQUNEOztBQW5Da0IsQ0FBckI7O0FBdUNBSSxPQUFPQyxPQUFQLEdBQWlCYixjQUFqQiIsImZpbGUiOiJUYXBFdmVudFBsdWdpbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTMtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogVGhpcyBzb3VyY2UgY29kZSBpcyBsaWNlbnNlZCB1bmRlciB0aGUgQlNELXN0eWxlIGxpY2Vuc2UgZm91bmQgaW4gdGhlXG4gKiBMSUNFTlNFIGZpbGUgaW4gdGhlIHJvb3QgZGlyZWN0b3J5IG9mIHRoaXMgc291cmNlIHRyZWUuIEFuIGFkZGl0aW9uYWwgZ3JhbnRcbiAqIG9mIHBhdGVudCByaWdodHMgY2FuIGJlIGZvdW5kIGluIHRoZSBQQVRFTlRTIGZpbGUgaW4gdGhlIHNhbWUgZGlyZWN0b3J5LlxuICpcbiAqIFxuICovXG5cbid1c2Ugc3RyaWN0JztcblxudmFyIEV2ZW50UGx1Z2luVXRpbHMgPSByZXF1aXJlKCcuL0V2ZW50UGx1Z2luVXRpbHMnKTtcbnZhciBFdmVudFByb3BhZ2F0b3JzID0gcmVxdWlyZSgnLi9FdmVudFByb3BhZ2F0b3JzJyk7XG52YXIgU3ludGhldGljVUlFdmVudCA9IHJlcXVpcmUoJy4vU3ludGhldGljVUlFdmVudCcpO1xudmFyIFRvdWNoRXZlbnRVdGlscyA9IHJlcXVpcmUoJ2ZianMvbGliL1RvdWNoRXZlbnRVdGlscycpO1xudmFyIFZpZXdwb3J0TWV0cmljcyA9IHJlcXVpcmUoJy4vVmlld3BvcnRNZXRyaWNzJyk7XG5cbnZhciBpc1N0YXJ0aXNoID0gRXZlbnRQbHVnaW5VdGlscy5pc1N0YXJ0aXNoO1xudmFyIGlzRW5kaXNoID0gRXZlbnRQbHVnaW5VdGlscy5pc0VuZGlzaDtcblxuLyoqXG4gKiBXZSBhcmUgZXh0ZW5kaW5nIHRoZSBGbG93ICdUb3VjaCcgZGVjbGFyYXRpb24gdG8gZW5hYmxlIHVzaW5nIGJyYWNrZXRcbiAqIG5vdGF0aW9uIHRvIGFjY2VzcyBwcm9wZXJ0aWVzLlxuICogV2l0aG91dCB0aGlzIGFkanVzdG1lbnQgRmxvdyB0aHJvd3NcbiAqIFwiSW5kZXhhYmxlIHNpZ25hdHVyZSBub3QgZm91bmQgaW4gVG91Y2hcIi5cbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svZmxvdy9pc3N1ZXMvMTMyM1xuICovXG5cblxuLyoqXG4gKiBOdW1iZXIgb2YgcGl4ZWxzIHRoYXQgYXJlIHRvbGVyYXRlZCBpbiBiZXR3ZWVuIGEgYHRvdWNoU3RhcnRgIGFuZCBgdG91Y2hFbmRgXG4gKiBpbiBvcmRlciB0byBzdGlsbCBiZSBjb25zaWRlcmVkIGEgJ3RhcCcgZXZlbnQuXG4gKi9cbnZhciB0YXBNb3ZlVGhyZXNob2xkID0gMTA7XG52YXIgc3RhcnRDb29yZHMgPSB7IHg6IDAsIHk6IDAgfTtcblxudmFyIEF4aXMgPSB7XG4gIHg6IHsgcGFnZTogJ3BhZ2VYJywgY2xpZW50OiAnY2xpZW50WCcsIGVudlNjcm9sbDogJ2N1cnJlbnRQYWdlU2Nyb2xsTGVmdCcgfSxcbiAgeTogeyBwYWdlOiAncGFnZVknLCBjbGllbnQ6ICdjbGllbnRZJywgZW52U2Nyb2xsOiAnY3VycmVudFBhZ2VTY3JvbGxUb3AnIH1cbn07XG5cbmZ1bmN0aW9uIGdldEF4aXNDb29yZE9mRXZlbnQoYXhpcywgbmF0aXZlRXZlbnQpIHtcbiAgdmFyIHNpbmdsZVRvdWNoID0gVG91Y2hFdmVudFV0aWxzLmV4dHJhY3RTaW5nbGVUb3VjaChuYXRpdmVFdmVudCk7XG4gIGlmIChzaW5nbGVUb3VjaCkge1xuICAgIHJldHVybiBzaW5nbGVUb3VjaFtheGlzLnBhZ2VdO1xuICB9XG4gIHJldHVybiBheGlzLnBhZ2UgaW4gbmF0aXZlRXZlbnQgPyBuYXRpdmVFdmVudFtheGlzLnBhZ2VdIDogbmF0aXZlRXZlbnRbYXhpcy5jbGllbnRdICsgVmlld3BvcnRNZXRyaWNzW2F4aXMuZW52U2Nyb2xsXTtcbn1cblxuZnVuY3Rpb24gZ2V0RGlzdGFuY2UoY29vcmRzLCBuYXRpdmVFdmVudCkge1xuICB2YXIgcGFnZVggPSBnZXRBeGlzQ29vcmRPZkV2ZW50KEF4aXMueCwgbmF0aXZlRXZlbnQpO1xuICB2YXIgcGFnZVkgPSBnZXRBeGlzQ29vcmRPZkV2ZW50KEF4aXMueSwgbmF0aXZlRXZlbnQpO1xuICByZXR1cm4gTWF0aC5wb3coTWF0aC5wb3cocGFnZVggLSBjb29yZHMueCwgMikgKyBNYXRoLnBvdyhwYWdlWSAtIGNvb3Jkcy55LCAyKSwgMC41KTtcbn1cblxudmFyIHRvdWNoRXZlbnRzID0gWyd0b3BUb3VjaFN0YXJ0JywgJ3RvcFRvdWNoQ2FuY2VsJywgJ3RvcFRvdWNoRW5kJywgJ3RvcFRvdWNoTW92ZSddO1xuXG52YXIgZGVwZW5kZW5jaWVzID0gWyd0b3BNb3VzZURvd24nLCAndG9wTW91c2VNb3ZlJywgJ3RvcE1vdXNlVXAnXS5jb25jYXQodG91Y2hFdmVudHMpO1xuXG52YXIgZXZlbnRUeXBlcyA9IHtcbiAgdG91Y2hUYXA6IHtcbiAgICBwaGFzZWRSZWdpc3RyYXRpb25OYW1lczoge1xuICAgICAgYnViYmxlZDogJ29uVG91Y2hUYXAnLFxuICAgICAgY2FwdHVyZWQ6ICdvblRvdWNoVGFwQ2FwdHVyZSdcbiAgICB9LFxuICAgIGRlcGVuZGVuY2llczogZGVwZW5kZW5jaWVzXG4gIH1cbn07XG5cbnZhciB1c2VkVG91Y2ggPSBmYWxzZTtcbnZhciB1c2VkVG91Y2hUaW1lID0gMDtcbnZhciBUT1VDSF9ERUxBWSA9IDEwMDA7XG5cbnZhciBUYXBFdmVudFBsdWdpbiA9IHtcblxuICB0YXBNb3ZlVGhyZXNob2xkOiB0YXBNb3ZlVGhyZXNob2xkLFxuXG4gIGV2ZW50VHlwZXM6IGV2ZW50VHlwZXMsXG5cbiAgZXh0cmFjdEV2ZW50czogZnVuY3Rpb24gKHRvcExldmVsVHlwZSwgdGFyZ2V0SW5zdCwgbmF0aXZlRXZlbnQsIG5hdGl2ZUV2ZW50VGFyZ2V0KSB7XG4gICAgaWYgKCFpc1N0YXJ0aXNoKHRvcExldmVsVHlwZSkgJiYgIWlzRW5kaXNoKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBvbiBpb3MsIHRoZXJlIGlzIGEgZGVsYXkgYWZ0ZXIgdG91Y2ggZXZlbnQgYW5kIHN5bnRoZXRpY1xuICAgIC8vIG1vdXNlIGV2ZW50cywgc28gdGhhdCB1c2VyIGNhbiBwZXJmb3JtIGRvdWJsZSB0YXBcbiAgICAvLyBzb2x1dGlvbjogaWdub3JlIG1vdXNlIGV2ZW50cyBmb2xsb3dpbmcgdG91Y2hldmVudCB3aXRoaW4gc21hbGwgdGltZWZyYW1lXG4gICAgaWYgKHRvdWNoRXZlbnRzLmluZGV4T2YodG9wTGV2ZWxUeXBlKSAhPT0gLTEpIHtcbiAgICAgIHVzZWRUb3VjaCA9IHRydWU7XG4gICAgICB1c2VkVG91Y2hUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHVzZWRUb3VjaCAmJiBEYXRlLm5vdygpIC0gdXNlZFRvdWNoVGltZSA8IFRPVUNIX0RFTEFZKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuICAgIH1cbiAgICB2YXIgZXZlbnQgPSBudWxsO1xuICAgIHZhciBkaXN0YW5jZSA9IGdldERpc3RhbmNlKHN0YXJ0Q29vcmRzLCBuYXRpdmVFdmVudCk7XG4gICAgaWYgKGlzRW5kaXNoKHRvcExldmVsVHlwZSkgJiYgZGlzdGFuY2UgPCB0YXBNb3ZlVGhyZXNob2xkKSB7XG4gICAgICBldmVudCA9IFN5bnRoZXRpY1VJRXZlbnQuZ2V0UG9vbGVkKGV2ZW50VHlwZXMudG91Y2hUYXAsIHRhcmdldEluc3QsIG5hdGl2ZUV2ZW50LCBuYXRpdmVFdmVudFRhcmdldCk7XG4gICAgfVxuICAgIGlmIChpc1N0YXJ0aXNoKHRvcExldmVsVHlwZSkpIHtcbiAgICAgIHN0YXJ0Q29vcmRzLnggPSBnZXRBeGlzQ29vcmRPZkV2ZW50KEF4aXMueCwgbmF0aXZlRXZlbnQpO1xuICAgICAgc3RhcnRDb29yZHMueSA9IGdldEF4aXNDb29yZE9mRXZlbnQoQXhpcy55LCBuYXRpdmVFdmVudCk7XG4gICAgfSBlbHNlIGlmIChpc0VuZGlzaCh0b3BMZXZlbFR5cGUpKSB7XG4gICAgICBzdGFydENvb3Jkcy54ID0gMDtcbiAgICAgIHN0YXJ0Q29vcmRzLnkgPSAwO1xuICAgIH1cbiAgICBFdmVudFByb3BhZ2F0b3JzLmFjY3VtdWxhdGVUd29QaGFzZURpc3BhdGNoZXMoZXZlbnQpO1xuICAgIHJldHVybiBldmVudDtcbiAgfVxuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IFRhcEV2ZW50UGx1Z2luOyJdfQ==