"use strict";

define(["../core", "../core/stripAndCollapse", "./support", "../core/init"], function (jQuery, stripAndCollapse, support) {

	"use strict";

	var rreturn = /\r/g;

	jQuery.fn.extend({
		val: function val(value) {
			var hooks,
			    ret,
			    isFunction,
			    elem = this[0];

			if (!arguments.length) {
				if (elem) {
					hooks = jQuery.valHooks[elem.type] || jQuery.valHooks[elem.nodeName.toLowerCase()];

					if (hooks && "get" in hooks && (ret = hooks.get(elem, "value")) !== undefined) {
						return ret;
					}

					ret = elem.value;

					// Handle most common string cases
					if (typeof ret === "string") {
						return ret.replace(rreturn, "");
					}

					// Handle cases where value is null/undef or number
					return ret == null ? "" : ret;
				}

				return;
			}

			isFunction = jQuery.isFunction(value);

			return this.each(function (i) {
				var val;

				if (this.nodeType !== 1) {
					return;
				}

				if (isFunction) {
					val = value.call(this, i, jQuery(this).val());
				} else {
					val = value;
				}

				// Treat null/undefined as ""; convert numbers to string
				if (val == null) {
					val = "";
				} else if (typeof val === "number") {
					val += "";
				} else if (jQuery.isArray(val)) {
					val = jQuery.map(val, function (value) {
						return value == null ? "" : value + "";
					});
				}

				hooks = jQuery.valHooks[this.type] || jQuery.valHooks[this.nodeName.toLowerCase()];

				// If set returns undefined, fall back to normal setting
				if (!hooks || !("set" in hooks) || hooks.set(this, val, "value") === undefined) {
					this.value = val;
				}
			});
		}
	});

	jQuery.extend({
		valHooks: {
			option: {
				get: function get(elem) {

					var val = jQuery.find.attr(elem, "value");
					return val != null ? val :

					// Support: IE <=10 - 11 only
					// option.text throws exceptions (#14686, #14858)
					// Strip and collapse whitespace
					// https://html.spec.whatwg.org/#strip-and-collapse-whitespace
					stripAndCollapse(jQuery.text(elem));
				}
			},
			select: {
				get: function get(elem) {
					var value,
					    option,
					    i,
					    options = elem.options,
					    index = elem.selectedIndex,
					    one = elem.type === "select-one",
					    values = one ? null : [],
					    max = one ? index + 1 : options.length;

					if (index < 0) {
						i = max;
					} else {
						i = one ? index : 0;
					}

					// Loop through all the selected options
					for (; i < max; i++) {
						option = options[i];

						// Support: IE <=9 only
						// IE8-9 doesn't update selected after form reset (#2551)
						if ((option.selected || i === index) &&

						// Don't return options that are disabled or in a disabled optgroup
						!option.disabled && (!option.parentNode.disabled || !jQuery.nodeName(option.parentNode, "optgroup"))) {

							// Get the specific value for the option
							value = jQuery(option).val();

							// We don't need an array for one selects
							if (one) {
								return value;
							}

							// Multi-Selects return an array
							values.push(value);
						}
					}

					return values;
				},

				set: function set(elem, value) {
					var optionSet,
					    option,
					    options = elem.options,
					    values = jQuery.makeArray(value),
					    i = options.length;

					while (i--) {
						option = options[i];

						/* eslint-disable no-cond-assign */

						if (option.selected = jQuery.inArray(jQuery.valHooks.option.get(option), values) > -1) {
							optionSet = true;
						}

						/* eslint-enable no-cond-assign */
					}

					// Force browsers to behave consistently when non-matching value is set
					if (!optionSet) {
						elem.selectedIndex = -1;
					}
					return values;
				}
			}
		}
	});

	// Radios and checkboxes getter/setter
	jQuery.each(["radio", "checkbox"], function () {
		jQuery.valHooks[this] = {
			set: function set(elem, value) {
				if (jQuery.isArray(value)) {
					return elem.checked = jQuery.inArray(jQuery(elem).val(), value) > -1;
				}
			}
		};
		if (!support.checkOn) {
			jQuery.valHooks[this].get = function (elem) {
				return elem.getAttribute("value") === null ? "on" : elem.value;
			};
		}
	});
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL3B1YmxpYy9saWIvanF1ZXJ5L3NyYy9hdHRyaWJ1dGVzL3ZhbC5qcyJdLCJuYW1lcyI6WyJkZWZpbmUiLCJqUXVlcnkiLCJzdHJpcEFuZENvbGxhcHNlIiwic3VwcG9ydCIsInJyZXR1cm4iLCJmbiIsImV4dGVuZCIsInZhbCIsInZhbHVlIiwiaG9va3MiLCJyZXQiLCJpc0Z1bmN0aW9uIiwiZWxlbSIsImFyZ3VtZW50cyIsImxlbmd0aCIsInZhbEhvb2tzIiwidHlwZSIsIm5vZGVOYW1lIiwidG9Mb3dlckNhc2UiLCJnZXQiLCJ1bmRlZmluZWQiLCJyZXBsYWNlIiwiZWFjaCIsImkiLCJub2RlVHlwZSIsImNhbGwiLCJpc0FycmF5IiwibWFwIiwic2V0Iiwib3B0aW9uIiwiZmluZCIsImF0dHIiLCJ0ZXh0Iiwic2VsZWN0Iiwib3B0aW9ucyIsImluZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm9uZSIsInZhbHVlcyIsIm1heCIsInNlbGVjdGVkIiwiZGlzYWJsZWQiLCJwYXJlbnROb2RlIiwicHVzaCIsIm9wdGlvblNldCIsIm1ha2VBcnJheSIsImluQXJyYXkiLCJjaGVja2VkIiwiY2hlY2tPbiIsImdldEF0dHJpYnV0ZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQUEsT0FBUSxDQUNQLFNBRE8sRUFFUCwwQkFGTyxFQUdQLFdBSE8sRUFJUCxjQUpPLENBQVIsRUFLRyxVQUFVQyxNQUFWLEVBQWtCQyxnQkFBbEIsRUFBb0NDLE9BQXBDLEVBQThDOztBQUVqRDs7QUFFQSxLQUFJQyxVQUFVLEtBQWQ7O0FBRUFILFFBQU9JLEVBQVAsQ0FBVUMsTUFBVixDQUFrQjtBQUNqQkMsT0FBSyxhQUFVQyxLQUFWLEVBQWtCO0FBQ3RCLE9BQUlDLEtBQUo7QUFBQSxPQUFXQyxHQUFYO0FBQUEsT0FBZ0JDLFVBQWhCO0FBQUEsT0FDQ0MsT0FBTyxLQUFNLENBQU4sQ0FEUjs7QUFHQSxPQUFLLENBQUNDLFVBQVVDLE1BQWhCLEVBQXlCO0FBQ3hCLFFB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QyxPQUFPNkMsT0FBUCxDQUFnQjdDLE9BQU9jLFFBQVAsQ0FBZ0JjLE1BQWhCLENBQXVCVixHQUF2QixDQUE0QlUsTUFBNUIsQ0FBaEIsRUFBc0RTLE1BQXRELElBQWlFLENBQUMsQ0FEbkUsRUFFRTtBQUNETSxtQkFBWSxJQUFaO0FBQ0E7O0FBRUQ7QUFDQTs7QUFFRDtBQUNBLFNBQUssQ0FBQ0EsU0FBTixFQUFrQjtBQUNqQmhDLFdBQUt3QixhQUFMLEdBQXFCLENBQUMsQ0FBdEI7QUFDQTtBQUNELFlBQU9FLE1BQVA7QUFDQTtBQXRFTTtBQWZDO0FBREksRUFBZjs7QUEyRkE7QUFDQXJDLFFBQU9xQixJQUFQLENBQWEsQ0FBRSxPQUFGLEVBQVcsVUFBWCxDQUFiLEVBQXNDLFlBQVc7QUFDaERyQixTQUFPYyxRQUFQLENBQWlCLElBQWpCLElBQTBCO0FBQ3pCYSxRQUFLLGFBQVVoQixJQUFWLEVBQWdCSixLQUFoQixFQUF3QjtBQUM1QixRQUFLUCxPQUFPeUIsT0FBUCxDQUFnQmxCLEtBQWhCLENBQUwsRUFBK0I7QUFDOUIsWUFBU0ksS0FBS21DLE9BQUwsR0FBZTlDLE9BQU82QyxPQUFQLENBQWdCN0MsT0FBUVcsSUFBUixFQUFlTCxHQUFmLEVBQWhCLEVBQXNDQyxLQUF0QyxJQUFnRCxDQUFDLENBQXpFO0FBQ0E7QUFDRDtBQUx3QixHQUExQjtBQU9BLE1BQUssQ0FBQ0wsUUFBUTZDLE9BQWQsRUFBd0I7QUFDdkIvQyxVQUFPYyxRQUFQLENBQWlCLElBQWpCLEVBQXdCSSxHQUF4QixHQUE4QixVQUFVUCxJQUFWLEVBQWlCO0FBQzlDLFdBQU9BLEtBQUtxQyxZQUFMLENBQW1CLE9BQW5CLE1BQWlDLElBQWpDLEdBQXdDLElBQXhDLEdBQStDckMsS0FBS0osS0FBM0Q7QUFDQSxJQUZEO0FBR0E7QUFDRCxFQWJEO0FBZUMsQ0EzTEQiLCJmaWxlIjoidmFsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiZGVmaW5lKCBbXG5cdFwiLi4vY29yZVwiLFxuXHRcIi4uL2NvcmUvc3RyaXBBbmRDb2xsYXBzZVwiLFxuXHRcIi4vc3VwcG9ydFwiLFxuXHRcIi4uL2NvcmUvaW5pdFwiXG5dLCBmdW5jdGlvbiggalF1ZXJ5LCBzdHJpcEFuZENvbGxhcHNlLCBzdXBwb3J0ICkge1xuXG5cInVzZSBzdHJpY3RcIjtcblxudmFyIHJyZXR1cm4gPSAvXFxyL2c7XG5cbmpRdWVyeS5mbi5leHRlbmQoIHtcblx0dmFsOiBmdW5jdGlvbiggdmFsdWUgKSB7XG5cdFx0dmFyIGhvb2tzLCByZXQsIGlzRnVuY3Rpb24sXG5cdFx0XHRlbGVtID0gdGhpc1sgMCBdO1xuXG5cdFx0aWYgKCAhYXJndW1lbnRzLmxlbmd0aCApIHtcblx0XHRcdGlmICggZWxlbSApIHtcblx0XHRcdFx0aG9va3MgPSBqUXVlcnkudmFsSG9va3NbIGVsZW0udHlwZSBdIHx8XG5cdFx0XHRcdFx0alF1ZXJ5LnZhbEhvb2tzWyBlbGVtLm5vZGVOYW1lLnRvTG93ZXJDYXNlKCkgXTtcblxuXHRcdFx0XHRpZiAoIGhvb2tzICYmXG5cdFx0XHRcdFx0XCJnZXRcIiBpbiBob29rcyAmJlxuXHRcdFx0XHRcdCggcmV0ID0gaG9va3MuZ2V0KCBlbGVtLCBcInZhbHVlXCIgKSApICE9PSB1bmRlZmluZWRcblx0XHRcdFx0KSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJldDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJldCA9IGVsZW0udmFsdWU7XG5cblx0XHRcdFx0Ly8gSGFuZGxlIG1vc3QgY29tbW9uIHN0cmluZyBjYXNlc1xuXHRcdFx0XHRpZiAoIHR5cGVvZiByZXQgPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHJldC5yZXBsYWNlKCBycmV0dXJuLCBcIlwiICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBIYW5kbGUgY2FzZXMgd2hlcmUgdmFsdWUgaXMgbnVsbC91bmRlZiBvciBudW1iZXJcblx0XHRcdFx0cmV0dXJuIHJldCA9PSBudWxsID8gXCJcIiA6IHJldDtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdGlzRnVuY3Rpb24gPSBqUXVlcnkuaXNGdW5jdGlvbiggdmFsdWUgKTtcblxuXHRcdHJldHVybiB0aGlzLmVhY2goIGZ1bmN0aW9uKCBpICkge1xuXHRcdFx0dmFyIHZhbDtcblxuXHRcdFx0aWYgKCB0aGlzLm5vZGVUeXBlICE9PSAxICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cblx0XHRcdGlmICggaXNGdW5jdGlvbiApIHtcblx0XHRcdFx0dmFsID0gdmFsdWUuY2FsbCggdGhpcywgaSwgalF1ZXJ5KCB0aGlzICkudmFsKCkgKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHZhbCA9IHZhbHVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBUcmVhdCBudWxsL3VuZGVmaW5lZCBhcyBcIlwiOyBjb252ZXJ0IG51bWJlcnMgdG8gc3RyaW5nXG5cdFx0XHRpZiAoIHZhbCA9PSBudWxsICkge1xuXHRcdFx0XHR2YWwgPSBcIlwiO1xuXG5cdFx0XHR9IGVsc2UgaWYgKCB0eXBlb2YgdmFsID09PSBcIm51bWJlclwiICkge1xuXHRcdFx0XHR2YWwgKz0gXCJcIjtcblxuXHRcdFx0fSBlbHNlIGlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbCApICkge1xuXHRcdFx0XHR2YWwgPSBqUXVlcnkubWFwKCB2YWwsIGZ1bmN0aW9uKCB2YWx1ZSApIHtcblx0XHRcdFx0XHRyZXR1cm4gdmFsdWUgPT0gbnVsbCA/IFwiXCIgOiB2YWx1ZSArIFwiXCI7XG5cdFx0XHRcdH0gKTtcblx0XHRcdH1cblxuXHRcdFx0aG9va3MgPSBqUXVlcnkudmFsSG9va3NbIHRoaXMudHlwZSBdIHx8IGpRdWVyeS52YWxIb29rc1sgdGhpcy5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpIF07XG5cblx0XHRcdC8vIElmIHNldCByZXR1cm5zIHVuZGVmaW5lZCwgZmFsbCBiYWNrIHRvIG5vcm1hbCBzZXR0aW5nXG5cdFx0XHRpZiAoICFob29rcyB8fCAhKCBcInNldFwiIGluIGhvb2tzICkgfHwgaG9va3Muc2V0KCB0aGlzLCB2YWwsIFwidmFsdWVcIiApID09PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdHRoaXMudmFsdWUgPSB2YWw7XG5cdFx0XHR9XG5cdFx0fSApO1xuXHR9XG59ICk7XG5cbmpRdWVyeS5leHRlbmQoIHtcblx0dmFsSG9va3M6IHtcblx0XHRvcHRpb246IHtcblx0XHRcdGdldDogZnVuY3Rpb24oIGVsZW0gKSB7XG5cblx0XHRcdFx0dmFyIHZhbCA9IGpRdWVyeS5maW5kLmF0dHIoIGVsZW0sIFwidmFsdWVcIiApO1xuXHRcdFx0XHRyZXR1cm4gdmFsICE9IG51bGwgP1xuXHRcdFx0XHRcdHZhbCA6XG5cblx0XHRcdFx0XHQvLyBTdXBwb3J0OiBJRSA8PTEwIC0gMTEgb25seVxuXHRcdFx0XHRcdC8vIG9wdGlvbi50ZXh0IHRocm93cyBleGNlcHRpb25zICgjMTQ2ODYsICMxNDg1OClcblx0XHRcdFx0XHQvLyBTdHJpcCBhbmQgY29sbGFwc2Ugd2hpdGVzcGFjZVxuXHRcdFx0XHRcdC8vIGh0dHBzOi8vaHRtbC5zcGVjLndoYXR3Zy5vcmcvI3N0cmlwLWFuZC1jb2xsYXBzZS13aGl0ZXNwYWNlXG5cdFx0XHRcdFx0c3RyaXBBbmRDb2xsYXBzZSggalF1ZXJ5LnRleHQoIGVsZW0gKSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0c2VsZWN0OiB7XG5cdFx0XHRnZXQ6IGZ1bmN0aW9uKCBlbGVtICkge1xuXHRcdFx0XHR2YXIgdmFsdWUsIG9wdGlvbiwgaSxcblx0XHRcdFx0XHRvcHRpb25zID0gZWxlbS5vcHRpb25zLFxuXHRcdFx0XHRcdGluZGV4ID0gZWxlbS5zZWxlY3RlZEluZGV4LFxuXHRcdFx0XHRcdG9uZSA9IGVsZW0udHlwZSA9PT0gXCJzZWxlY3Qtb25lXCIsXG5cdFx0XHRcdFx0dmFsdWVzID0gb25lID8gbnVsbCA6IFtdLFxuXHRcdFx0XHRcdG1heCA9IG9uZSA/IGluZGV4ICsgMSA6IG9wdGlvbnMubGVuZ3RoO1xuXG5cdFx0XHRcdGlmICggaW5kZXggPCAwICkge1xuXHRcdFx0XHRcdGkgPSBtYXg7XG5cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRpID0gb25lID8gaW5kZXggOiAwO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTG9vcCB0aHJvdWdoIGFsbCB0aGUgc2VsZWN0ZWQgb3B0aW9uc1xuXHRcdFx0XHRmb3IgKCA7IGkgPCBtYXg7IGkrKyApIHtcblx0XHRcdFx0XHRvcHRpb24gPSBvcHRpb25zWyBpIF07XG5cblx0XHRcdFx0XHQvLyBTdXBwb3J0OiBJRSA8PTkgb25seVxuXHRcdFx0XHRcdC8vIElFOC05IGRvZXNuJ3QgdXBkYXRlIHNlbGVjdGVkIGFmdGVyIGZvcm0gcmVzZXQgKCMyNTUxKVxuXHRcdFx0XHRcdGlmICggKCBvcHRpb24uc2VsZWN0ZWQgfHwgaSA9PT0gaW5kZXggKSAmJlxuXG5cdFx0XHRcdFx0XHRcdC8vIERvbid0IHJldHVybiBvcHRpb25zIHRoYXQgYXJlIGRpc2FibGVkIG9yIGluIGEgZGlzYWJsZWQgb3B0Z3JvdXBcblx0XHRcdFx0XHRcdFx0IW9wdGlvbi5kaXNhYmxlZCAmJlxuXHRcdFx0XHRcdFx0XHQoICFvcHRpb24ucGFyZW50Tm9kZS5kaXNhYmxlZCB8fFxuXHRcdFx0XHRcdFx0XHRcdCFqUXVlcnkubm9kZU5hbWUoIG9wdGlvbi5wYXJlbnROb2RlLCBcIm9wdGdyb3VwXCIgKSApICkge1xuXG5cdFx0XHRcdFx0XHQvLyBHZXQgdGhlIHNwZWNpZmljIHZhbHVlIGZvciB0aGUgb3B0aW9uXG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGpRdWVyeSggb3B0aW9uICkudmFsKCk7XG5cblx0XHRcdFx0XHRcdC8vIFdlIGRvbid0IG5lZWQgYW4gYXJyYXkgZm9yIG9uZSBzZWxlY3RzXG5cdFx0XHRcdFx0XHRpZiAoIG9uZSApIHtcblx0XHRcdFx0XHRcdFx0cmV0dXJuIHZhbHVlO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHQvLyBNdWx0aS1TZWxlY3RzIHJldHVybiBhbiBhcnJheVxuXHRcdFx0XHRcdFx0dmFsdWVzLnB1c2goIHZhbHVlICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdFx0cmV0dXJuIHZhbHVlcztcblx0XHRcdH0sXG5cblx0XHRcdHNldDogZnVuY3Rpb24oIGVsZW0sIHZhbHVlICkge1xuXHRcdFx0XHR2YXIgb3B0aW9uU2V0LCBvcHRpb24sXG5cdFx0XHRcdFx0b3B0aW9ucyA9IGVsZW0ub3B0aW9ucyxcblx0XHRcdFx0XHR2YWx1ZXMgPSBqUXVlcnkubWFrZUFycmF5KCB2YWx1ZSApLFxuXHRcdFx0XHRcdGkgPSBvcHRpb25zLmxlbmd0aDtcblxuXHRcdFx0XHR3aGlsZSAoIGktLSApIHtcblx0XHRcdFx0XHRvcHRpb24gPSBvcHRpb25zWyBpIF07XG5cblx0XHRcdFx0XHQvKiBlc2xpbnQtZGlzYWJsZSBuby1jb25kLWFzc2lnbiAqL1xuXG5cdFx0XHRcdFx0aWYgKCBvcHRpb24uc2VsZWN0ZWQgPVxuXHRcdFx0XHRcdFx0alF1ZXJ5LmluQXJyYXkoIGpRdWVyeS52YWxIb29rcy5vcHRpb24uZ2V0KCBvcHRpb24gKSwgdmFsdWVzICkgPiAtMVxuXHRcdFx0XHRcdCkge1xuXHRcdFx0XHRcdFx0b3B0aW9uU2V0ID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvKiBlc2xpbnQtZW5hYmxlIG5vLWNvbmQtYXNzaWduICovXG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBGb3JjZSBicm93c2VycyB0byBiZWhhdmUgY29uc2lzdGVudGx5IHdoZW4gbm9uLW1hdGNoaW5nIHZhbHVlIGlzIHNldFxuXHRcdFx0XHRpZiAoICFvcHRpb25TZXQgKSB7XG5cdFx0XHRcdFx0ZWxlbS5zZWxlY3RlZEluZGV4ID0gLTE7XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHZhbHVlcztcblx0XHRcdH1cblx0XHR9XG5cdH1cbn0gKTtcblxuLy8gUmFkaW9zIGFuZCBjaGVja2JveGVzIGdldHRlci9zZXR0ZXJcbmpRdWVyeS5lYWNoKCBbIFwicmFkaW9cIiwgXCJjaGVja2JveFwiIF0sIGZ1bmN0aW9uKCkge1xuXHRqUXVlcnkudmFsSG9va3NbIHRoaXMgXSA9IHtcblx0XHRzZXQ6IGZ1bmN0aW9uKCBlbGVtLCB2YWx1ZSApIHtcblx0XHRcdGlmICggalF1ZXJ5LmlzQXJyYXkoIHZhbHVlICkgKSB7XG5cdFx0XHRcdHJldHVybiAoIGVsZW0uY2hlY2tlZCA9IGpRdWVyeS5pbkFycmF5KCBqUXVlcnkoIGVsZW0gKS52YWwoKSwgdmFsdWUgKSA+IC0xICk7XG5cdFx0XHR9XG5cdFx0fVxuXHR9O1xuXHRpZiAoICFzdXBwb3J0LmNoZWNrT24gKSB7XG5cdFx0alF1ZXJ5LnZhbEhvb2tzWyB0aGlzIF0uZ2V0ID0gZnVuY3Rpb24oIGVsZW0gKSB7XG5cdFx0XHRyZXR1cm4gZWxlbS5nZXRBdHRyaWJ1dGUoIFwidmFsdWVcIiApID09PSBudWxsID8gXCJvblwiIDogZWxlbS52YWx1ZTtcblx0XHR9O1xuXHR9XG59ICk7XG5cbn0gKTtcbiJdfQ==