'use strict';

var baseSetData = require('./_baseSetData'),
    createBind = require('./_createBind'),
    createCurry = require('./_createCurry'),
    createHybrid = require('./_createHybrid'),
    createPartial = require('./_createPartial'),
    getData = require('./_getData'),
    mergeData = require('./_mergeData'),
    setData = require('./_setData'),
    setWrapToString = require('./_setWrapToString'),
    toInteger = require('./toInteger');

/** Error message constants. */
var FUNC_ERROR_TEXT = 'Expected a function';

/** Used to compose bitmasks for function metadata. */
var WRAP_BIND_FLAG = 1,
    WRAP_BIND_KEY_FLAG = 2,
    WRAP_CURRY_FLAG = 8,
    WRAP_CURRY_RIGHT_FLAG = 16,
    WRAP_PARTIAL_FLAG = 32,
    WRAP_PARTIAL_RIGHT_FLAG = 64;

/* Built-in method references for those with the same name as other `lodash` methods. */
var nativeMax = Math.max;

/**
 * Creates a function that either curries or invokes `func` with optional
 * `this` binding and partially applied arguments.
 *
 * @private
 * @param {Function|string} func The function or method name to wrap.
 * @param {number} bitmask The bitmask flags.
 *    1 - `_.bind`
 *    2 - `_.bindKey`
 *    4 - `_.curry` or `_.curryRight` of a bound function
 *    8 - `_.curry`
 *   16 - `_.curryRight`
 *   32 - `_.partial`
 *   64 - `_.partialRight`
 *  128 - `_.rearg`
 *  256 - `_.ary`
 *  512 - `_.flip`
 * @param {*} [thisArg] The `this` binding of `func`.
 * @param {Array} [partials] The arguments to be partially applied.
 * @param {Array} [holders] The `partials` placeholder indexes.
 * @param {Array} [argPos] The argument positions of the new function.
 * @param {number} [ary] The arity cap of `func`.
 * @param {number} [arity] The arity of `func`.
 * @returns {Function} Returns the new wrapped function.
 */
function createWrap(func, bitmask, thisArg, partials, holders, argPos, ary, arity) {
  var isBindKey = bitmask & WRAP_BIND_KEY_FLAG;
  if (!isBindKey && typeof func != 'function') {
    throw new TypeError(FUNC_ERROR_TEXT);
  }
  var length = partials ? partials.length : 0;
  if (!length) {
    bitmask &= ~(WRAP_PARTIAL_FLAG | WRAP_PARTIAL_RIGHT_FLAG);
    partials = holders = undefined;
  }
  ary = ary === undefined ? ary : nativeMax(toInteger(ary), 0);
  arity = arity === undefined ? arity : toInteger(arity);
  length -= holders ? holders.length : 0;

  if (bitmask & WRAP_PARTIAL_RIGHT_FLAG) {
    var partialsRight = partials,
        holdersRight = holders;

    partials = holders = undefined;
  }
  var data = isBindKey ? undefined : getData(func);

  var newData = [func, bitmask, thisArg, partials, holders, partialsRight, holdersRight, argPos, ary, arity];

  if (data) {
    mergeData(newData, data);
  }
  func = newData[0];
  bitmask = newData[1];
  thisArg = newData[2];
  partials = newData[3];
  holders = newData[4];
  arity = newData[9] = newData[9] === undefined ? isBindKey ? 0 : func.length : nativeMax(newData[9] - length, 0);

  if (!arity && bitmask & (WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG)) {
    bitmask &= ~(WRAP_CURRY_FLAG | WRAP_CURRY_RIGHT_FLAG);
  }
  if (!bitmask || bitmask == WRAP_BIND_FLAG) {
    var result = createBind(func, bitmask, thisArg);
  } else if (bitmask == WRAP_CURRY_FLAG || bitmask == WRAP_CURRY_RIGHT_FLAG) {
    result = createCurry(func, bitmask, arity);
  } else if ((bitmask == WRAP_PARTIAL_FLAG || bitmask == (WRAP_BIND_FLAG | WRAP_PARTIAL_FLAG)) && !holders.length) {
    result = createPartial(func, bitmask, thisArg, partials);
  } else {
    result = createHybrid.apply(undefined, newData);
  }
  var setter = data ? baseSetData : setData;
  return setWrapToString(setter(result, newData), func, bitmask);
}

module.exports = createWrap;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3B1YmxpYy9saWIvbG9kYXNoL19jcmVhdGVXcmFwLmpzIl0sIm5hbWVzIjpbImJhc2VTZXREYXRhIiwicmVxdWlyZSIsImNyZWF0ZUJpbmQiLCJjcmVhdGVDdXJyeSIsImNyZWF0ZUh5YnJpZCIsImNyZWF0ZVBhcnRpYWwiLCJnZXREYXRhIiwibWVyZ2VEYXRhIiwic2V0RGF0YSIsInNldFdyYXBUb1N0cmluZyIsInRvSW50ZWdlciIsIkZVTkNfRVJST1JfVEVYVCIsIldSQVBfQklORF9GTEFHIiwiV1JBUF9CSU5EX0tFWV9GTEFHIiwiV1JBUF9DVVJSWV9GTEFHIiwiV1JBUF9DVVJSWV9SSUdIVF9GTEFHIiwiV1JBUF9QQVJUSUFMX0ZMQUciLCJXUkFQX1BBUlRJQUxfUklHSFRfRkxBRyIsIm5hdGl2ZU1heCIsIk1hdGgiLCJtYXgiLCJjcmVhdGVXcmFwIiwiZnVuYyIsImJpdG1hc2siLCJ0aGlzQXJnIiwicGFydGlhbHMiLCJob2xkZXJzIiwiYXJnUG9zIiwiYXJ5IiwiYXJpdHkiLCJpc0JpbmRLZXkiLCJUeXBlRXJyb3IiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJwYXJ0aWFsc1JpZ2h0IiwiaG9sZGVyc1JpZ2h0IiwiZGF0YSIsIm5ld0RhdGEiLCJyZXN1bHQiLCJhcHBseSIsInNldHRlciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBSUEsY0FBY0MsUUFBUSxnQkFBUixDQUFsQjtBQUFBLElBQ0lDLGFBQWFELFFBQVEsZUFBUixDQURqQjtBQUFBLElBRUlFLGNBQWNGLFFBQVEsZ0JBQVIsQ0FGbEI7QUFBQSxJQUdJRyxlQUFlSCxRQUFRLGlCQUFSLENBSG5CO0FBQUEsSUFJSUksZ0JBQWdCSixRQUFRLGtCQUFSLENBSnBCO0FBQUEsSUFLSUssVUFBVUwsUUFBUSxZQUFSLENBTGQ7QUFBQSxJQU1JTSxZQUFZTixRQUFRLGNBQVIsQ0FOaEI7QUFBQSxJQU9JTyxVQUFVUCxRQUFRLFlBQVIsQ0FQZDtB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O0FBQ3pFdUIsYUFBU25DLFlBQVltQixJQUFaLEVBQWtCQyxPQUFsQixFQUEyQk0sS0FBM0IsQ0FBVDtBQUNELEdBRk0sTUFFQSxJQUFJLENBQUNOLFdBQVdQLGlCQUFYLElBQWdDTyxZQUFZWCxpQkFBaUJJLGlCQUE3QixDQUFqQyxLQUFxRixDQUFDVSxRQUFRTSxNQUFsRyxFQUEwRztBQUMvR00sYUFBU2pDLGNBQWNpQixJQUFkLEVBQW9CQyxPQUFwQixFQUE2QkMsT0FBN0IsRUFBc0NDLFFBQXRDLENBQVQ7QUFDRCxHQUZNLE1BRUE7QUFDTGEsYUFBU2xDLGFBQWFtQyxLQUFiLENBQW1CTixTQUFuQixFQUE4QkksT0FBOUIsQ0FBVDtBQUNEO0FBQ0QsTUFBSUcsU0FBU0osT0FBT3BDLFdBQVAsR0FBcUJRLE9BQWxDO0FBQ0EsU0FBT0MsZ0JBQWdCK0IsT0FBT0YsTUFBUCxFQUFlRCxPQUFmLENBQWhCLEVBQXlDZixJQUF6QyxFQUErQ0MsT0FBL0MsQ0FBUDtBQUNEOztBQUVEa0IsT0FBT0MsT0FBUCxHQUFpQnJCLFVBQWpCIiwiZmlsZSI6Il9jcmVhdGVXcmFwLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJhc2VTZXREYXRhID0gcmVxdWlyZSgnLi9fYmFzZVNldERhdGEnKSxcbiAgICBjcmVhdGVCaW5kID0gcmVxdWlyZSgnLi9fY3JlYXRlQmluZCcpLFxuICAgIGNyZWF0ZUN1cnJ5ID0gcmVxdWlyZSgnLi9fY3JlYXRlQ3VycnknKSxcbiAgICBjcmVhdGVIeWJyaWQgPSByZXF1aXJlKCcuL19jcmVhdGVIeWJyaWQnKSxcbiAgICBjcmVhdGVQYXJ0aWFsID0gcmVxdWlyZSgnLi9fY3JlYXRlUGFydGlhbCcpLFxuICAgIGdldERhdGEgPSByZXF1aXJlKCcuL19nZXREYXRhJyksXG4gICAgbWVyZ2VEYXRhID0gcmVxdWlyZSgnLi9fbWVyZ2VEYXRhJyksXG4gICAgc2V0RGF0YSA9IHJlcXVpcmUoJy4vX3NldERhdGEnKSxcbiAgICBzZXRXcmFwVG9TdHJpbmcgPSByZXF1aXJlKCcuL19zZXRXcmFwVG9TdHJpbmcnKSxcbiAgICB0b0ludGVnZXIgPSByZXF1aXJlKCcuL3RvSW50ZWdlcicpO1xuXG4vKiogRXJyb3IgbWVzc2FnZSBjb25zdGFudHMuICovXG52YXIgRlVOQ19FUlJPUl9URVhUID0gJ0V4cGVjdGVkIGEgZnVuY3Rpb24nO1xuXG4vKiogVXNlZCB0byBjb21wb3NlIGJpdG1hc2tzIGZvciBmdW5jdGlvbiBtZXRhZGF0YS4gKi9cbnZhciBXUkFQX0JJTkRfRkxBRyA9IDEsXG4gICAgV1JBUF9CSU5EX0tFWV9GTEFHID0gMixcbiAgICBXUkFQX0NVUlJZX0ZMQUcgPSA4LFxuICAgIFdSQVBfQ1VSUllfUklHSFRfRkxBRyA9IDE2LFxuICAgIFdSQVBfUEFSVElBTF9GTEFHID0gMzIsXG4gICAgV1JBUF9QQVJUSUFMX1JJR0hUX0ZMQUcgPSA2NDtcblxuLyogQnVpbHQtaW4gbWV0aG9kIHJlZmVyZW5jZXMgZm9yIHRob3NlIHdpdGggdGhlIHNhbWUgbmFtZSBhcyBvdGhlciBgbG9kYXNoYCBtZXRob2RzLiAqL1xudmFyIG5hdGl2ZU1heCA9IE1hdGgubWF4O1xuXG4vKipcbiAqIENyZWF0ZXMgYSBmdW5jdGlvbiB0aGF0IGVpdGhlciBjdXJyaWVzIG9yIGludm9rZXMgYGZ1bmNgIHdpdGggb3B0aW9uYWxcbiAqIGB0aGlzYCBiaW5kaW5nIGFuZCBwYXJ0aWFsbHkgYXBwbGllZCBhcmd1bWVudHMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBwYXJhbSB7RnVuY3Rpb258c3RyaW5nfSBmdW5jIFRoZSBmdW5jdGlvbiBvciBtZXRob2QgbmFtZSB0byB3cmFwLlxuICogQHBhcmFtIHtudW1iZXJ9IGJpdG1hc2sgVGhlIGJpdG1hc2sgZmxhZ3MuXG4gKiAgICAxIC0gYF8uYmluZGBcbiAqICAgIDIgLSBgXy5iaW5kS2V5YFxuICogICAgNCAtIGBfLmN1cnJ5YCBvciBgXy5jdXJyeVJpZ2h0YCBvZiBhIGJvdW5kIGZ1bmN0aW9uXG4gKiAgICA4IC0gYF8uY3VycnlgXG4gKiAgIDE2IC0gYF8uY3VycnlSaWdodGBcbiAqICAgMzIgLSBgXy5wYXJ0aWFsYFxuICogICA2NCAtIGBfLnBhcnRpYWxSaWdodGBcbiAqICAxMjggLSBgXy5yZWFyZ2BcbiAqICAyNTYgLSBgXy5hcnlgXG4gKiAgNTEyIC0gYF8uZmxpcGBcbiAqIEBwYXJhbSB7Kn0gW3RoaXNBcmddIFRoZSBgdGhpc2AgYmluZGluZyBvZiBgZnVuY2AuXG4gKiBAcGFyYW0ge0FycmF5fSBbcGFydGlhbHNdIFRoZSBhcmd1bWVudHMgdG8gYmUgcGFydGlhbGx5IGFwcGxpZWQuXG4gKiBAcGFyYW0ge0FycmF5fSBbaG9sZGVyc10gVGhlIGBwYXJ0aWFsc2AgcGxhY2Vob2xkZXIgaW5kZXhlcy5cbiAqIEBwYXJhbSB7QXJyYXl9IFthcmdQb3NdIFRoZSBhcmd1bWVudCBwb3NpdGlvbnMgb2YgdGhlIG5ldyBmdW5jdGlvbi5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbYXJ5XSBUaGUgYXJpdHkgY2FwIG9mIGBmdW5jYC5cbiAqIEBwYXJhbSB7bnVtYmVyfSBbYXJpdHldIFRoZSBhcml0eSBvZiBgZnVuY2AuXG4gKiBAcmV0dXJucyB7RnVuY3Rpb259IFJldHVybnMgdGhlIG5ldyB3cmFwcGVkIGZ1bmN0aW9uLlxuICovXG5mdW5jdGlvbiBjcmVhdGVXcmFwKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzLCBob2xkZXJzLCBhcmdQb3MsIGFyeSwgYXJpdHkpIHtcbiAgdmFyIGlzQmluZEtleSA9IGJpdG1hc2sgJiBXUkFQX0JJTkRfS0VZX0ZMQUc7XG4gIGlmICghaXNCaW5kS2V5ICYmIHR5cGVvZiBmdW5jICE9ICdmdW5jdGlvbicpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKEZVTkNfRVJST1JfVEVYVCk7XG4gIH1cbiAgdmFyIGxlbmd0aCA9IHBhcnRpYWxzID8gcGFydGlhbHMubGVuZ3RoIDogMDtcbiAgaWYgKCFsZW5ndGgpIHtcbiAgICBiaXRtYXNrICY9IH4oV1JBUF9QQVJUSUFMX0ZMQUcgfCBXUkFQX1BBUlRJQUxfUklHSFRfRkxBRyk7XG4gICAgcGFydGlhbHMgPSBob2xkZXJzID0gdW5kZWZpbmVkO1xuICB9XG4gIGFyeSA9IGFyeSA9PT0gdW5kZWZpbmVkID8gYXJ5IDogbmF0aXZlTWF4KHRvSW50ZWdlcihhcnkpLCAwKTtcbiAgYXJpdHkgPSBhcml0eSA9PT0gdW5kZWZpbmVkID8gYXJpdHkgOiB0b0ludGVnZXIoYXJpdHkpO1xuICBsZW5ndGggLT0gaG9sZGVycyA/IGhvbGRlcnMubGVuZ3RoIDogMDtcblxuICBpZiAoYml0bWFzayAmIFdSQVBfUEFSVElBTF9SSUdIVF9GTEFHKSB7XG4gICAgdmFyIHBhcnRpYWxzUmlnaHQgPSBwYXJ0aWFscyxcbiAgICAgICAgaG9sZGVyc1JpZ2h0ID0gaG9sZGVycztcblxuICAgIHBhcnRpYWxzID0gaG9sZGVycyA9IHVuZGVmaW5lZDtcbiAgfVxuICB2YXIgZGF0YSA9IGlzQmluZEtleSA/IHVuZGVmaW5lZCA6IGdldERhdGEoZnVuYyk7XG5cbiAgdmFyIG5ld0RhdGEgPSBbXG4gICAgZnVuYywgYml0bWFzaywgdGhpc0FyZywgcGFydGlhbHMsIGhvbGRlcnMsIHBhcnRpYWxzUmlnaHQsIGhvbGRlcnNSaWdodCxcbiAgICBhcmdQb3MsIGFyeSwgYXJpdHlcbiAgXTtcblxuICBpZiAoZGF0YSkge1xuICAgIG1lcmdlRGF0YShuZXdEYXRhLCBkYXRhKTtcbiAgfVxuICBmdW5jID0gbmV3RGF0YVswXTtcbiAgYml0bWFzayA9IG5ld0RhdGFbMV07XG4gIHRoaXNBcmcgPSBuZXdEYXRhWzJdO1xuICBwYXJ0aWFscyA9IG5ld0RhdGFbM107XG4gIGhvbGRlcnMgPSBuZXdEYXRhWzRdO1xuICBhcml0eSA9IG5ld0RhdGFbOV0gPSBuZXdEYXRhWzldID09PSB1bmRlZmluZWRcbiAgICA/IChpc0JpbmRLZXkgPyAwIDogZnVuYy5sZW5ndGgpXG4gICAgOiBuYXRpdmVNYXgobmV3RGF0YVs5XSAtIGxlbmd0aCwgMCk7XG5cbiAgaWYgKCFhcml0eSAmJiBiaXRtYXNrICYgKFdSQVBfQ1VSUllfRkxBRyB8IFdSQVBfQ1VSUllfUklHSFRfRkxBRykpIHtcbiAgICBiaXRtYXNrICY9IH4oV1JBUF9DVVJSWV9GTEFHIHwgV1JBUF9DVVJSWV9SSUdIVF9GTEFHKTtcbiAgfVxuICBpZiAoIWJpdG1hc2sgfHwgYml0bWFzayA9PSBXUkFQX0JJTkRfRkxBRykge1xuICAgIHZhciByZXN1bHQgPSBjcmVhdGVCaW5kKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcpO1xuICB9IGVsc2UgaWYgKGJpdG1hc2sgPT0gV1JBUF9DVVJSWV9GTEFHIHx8IGJpdG1hc2sgPT0gV1JBUF9DVVJSWV9SSUdIVF9GTEFHKSB7XG4gICAgcmVzdWx0ID0gY3JlYXRlQ3VycnkoZnVuYywgYml0bWFzaywgYXJpdHkpO1xuICB9IGVsc2UgaWYgKChiaXRtYXNrID09IFdSQVBfUEFSVElBTF9GTEFHIHx8IGJpdG1hc2sgPT0gKFdSQVBfQklORF9GTEFHIHwgV1JBUF9QQVJUSUFMX0ZMQUcpKSAmJiAhaG9sZGVycy5sZW5ndGgpIHtcbiAgICByZXN1bHQgPSBjcmVhdGVQYXJ0aWFsKGZ1bmMsIGJpdG1hc2ssIHRoaXNBcmcsIHBhcnRpYWxzKTtcbiAgfSBlbHNlIHtcbiAgICByZXN1bHQgPSBjcmVhdGVIeWJyaWQuYXBwbHkodW5kZWZpbmVkLCBuZXdEYXRhKTtcbiAgfVxuICB2YXIgc2V0dGVyID0gZGF0YSA/IGJhc2VTZXREYXRhIDogc2V0RGF0YTtcbiAgcmV0dXJuIHNldFdyYXBUb1N0cmluZyhzZXR0ZXIocmVzdWx0LCBuZXdEYXRhKSwgZnVuYywgYml0bWFzayk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gY3JlYXRlV3JhcDtcbiJdfQ==